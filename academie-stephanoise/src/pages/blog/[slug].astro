---
import Layout from "../../layouts/Layout.astro";
import BlogContent from "../../components/BlogContent.jsx"; // React component for Rich Text
import { contentfulClient } from "../../../contentful.js";
import Heading from "../../components/foundations/Heading.jsx";
import BodyText from "../../components/foundations/BodyText.jsx";
import Navbar from "../../components/Navbar.jsx";
import Footer from "../../components/Footer.jsx";
// Generate all possible paths for the blog posts
export async function getStaticPaths() {
  const entries = await contentfulClient.getEntries({
    content_type: "blogPost",
  });

  return entries.items.map((item) => ({
    params: { slug: item.fields.slug },
  }));
}

// Get the slug from URL params
const { slug } = Astro.params;

// Fetch the blog post data
const entry = await contentfulClient.getEntries({
  content_type: "blogPost",
  "fields.slug": slug,
  include: 1, // Include linked assets
});

if (!entry.items.length) {
  throw new Error(`No post found for slug: ${slug}`);
}

const post = entry.items[0].fields;

// Set SEO metadata
const title = `${post.titre} - Académie Stéphanoise`;
const description = post.contenus.content[0]?.content[0]?.value || post.titre;
const keywords = `${post.titre}, Académie Stéphanoise, articles`;
---

<Layout title={title} description={description} keywords={keywords}>
  <Navbar client:only="react" />
  <article class="max-w-7xl py-12 lg:py-24 mx-auto p-4">
    <Heading className="max-w-4xl" level={1}>{post.titre}</Heading>
    <BodyText variant="label" className="my-4">
      {post.auteur} - {new Date(post.datePublication).toLocaleDateString()}
    </BodyText>

    <!-- Render the blog content using a React component -->
    <div class="max-w-prose">
      <BlogContent content={post.contenus} />
    </div>
  </article>
  <Footer />
</Layout>
